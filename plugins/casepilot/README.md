# CasePilot

智能测试用例生成器。从需求文档自动生成 **混合结构 Markdown** 格式的测试用例（可用 markmap 渲染）。

## 功能特性

- **7 步高效工作流**：解析与获取 → 分析与策略 → 用例设计 → 生成文件 → Review 审查 → 覆盖度报告 → 总结
- **二八法则**：每个需求点生成 3-8 个测试点
- **7 层链式用例结构**：标题 → 模块 → 用例名称 → 前置条件 → 执行步骤 → 预期结果 → 优先级
- **多测试类型**：PRD UI/交互、功能、边界、异常、兼容性、状态机
- **验收标准覆盖**：确保每条验收标准都有对应的测试用例
- **Review 审查**：自动调用 superpowers:code-reviewer 检查用例质量
- **多输入源**：飞书项目单、飞书云文档、本地文件
- **Context 优化**：中间结果精简输出，节省约 87% 的 token 消耗

## 前置要求

### 必需

- Claude Code CLI

### 可选（根据输入源）

| 输入源 | 所需 MCP 服务器 |
|--------|----------------|
| 本地文件 | 无 |
| 飞书项目单 | `lark-prj-new`（回退 `lark-prj-remote`） |
| 飞书云文档 | `lark-mcp-remote` |

## 使用方法

### 命令方式

```bash
# 从飞书项目单生成
/casepilot:generate https://project.feishu.cn/xxx/story/detail/xxx

# 从飞书云文档生成
/casepilot:generate https://xxx.feishu.cn/docx/xxx

# 从本地文件生成
/casepilot:generate ./docs/requirement.md

# 检查 MCP 配置
/casepilot:check-mcp
```

### 自然语言方式

```
帮我为这个需求生成测试用例：[需求描述]

请根据这个飞书项目单生成 XMind 测试用例：[URL]

为以下功能设计测试点和测试用例：[功能描述]
```

## 7 步工作流

### 步骤 1：解析输入与获取需求

解析输入类型，获取需求内容，读取技术设计文档。仅输出简短摘要。

### 步骤 2：需求分析与测试策略

需求分析、操作流程梳理、测试策略制定（内部处理），输出精简分析摘要后请求用户确认。

**唯一确认点**：用户确认分析摘要后继续。

### 步骤 3：用例设计与覆盖度验证

边设计边验证覆盖度，发现遗漏立即补充。包含智能优化。

### 步骤 4：生成 Markdown 文件

生成 7 层混合结构 Markdown，保存到 `~/Testcase/markmap/`。

### 步骤 5：Review 审查

检测 superpowers 插件，调用 `superpowers:code-reviewer` 审查用例质量（格式一致性、命名规范、覆盖完整性）。发现问题自动修复。

### 步骤 6：覆盖度报告

输出验收标准覆盖表和测试类型覆盖表。

### 步骤 7：输出总结

输出需求名称、用例统计、文件路径，以及飞书导入指引。

## 输出格式

### Markdown 混合结构

```markdown
# 文档标题

## 1. 模块名

### 验证{功能}{场景}
- 前置条件
  - 执行步骤
    - 预期结果
      - P0
```

### 层级格式规范

| 层级 | 内容 | 格式 |
|------|------|------|
| L1 | 文档标题 | `# ` |
| L2 | 模块名 | `## {N}. {模块名}` |
| L3 | 用例名 | `### ` |
| L4 | 前置条件 | `- ` |
| L5 | 测试步骤 | `  - ` (2空格缩进) |
| L6 | 预期结果 | `    - ` (4空格缩进) |
| L7 | 优先级 | `      - ` (6空格缩进) |

### 输出路径

```
~/Testcase/markmap/{工作项名称}_测试用例_{时间戳}.md
```

## 优先级说明

| 优先级 | 重要性 | 适用场景 |
|--------|--------|----------|
| **P0** | 最高 | 核心功能、验收标准相关、主流程、PRD UI/交互核心功能 |
| **P1** | 中等 | 边界条件、配置验证、异常处理、主题/语言切换 |
| **P2** | 较低 | 辅助功能、稳定性测试、极端场景 |

## 常见问题

### Q: MCP 服务未配置怎么办？

运行 `/casepilot:check-mcp` 查看配置状态和指引。

### Q: 可以只使用本地文件吗？

可以。本地文件模式不需要任何 MCP 服务器。

### Q: 生成的 Markdown 文件如何使用？

可用 VS Code markmap 插件或其他 markmap 工具渲染为思维导图。

### Q: 如何将生成的用例导入飞书项目？

生成的 Markdown 文件可通过 XMind 中转导入飞书项目：
1. 使用 XMind 打开 → 文件 → 导入 → Markdown → 选择生成的 .md 文件
2. 保存为 .xmind 格式
3. 在飞书项目 > 测试管理 > 用例库 > 导入 > XMind 导入（自由模式）

### Q: Review 审查需要什么插件？

Review 审查依赖 `superpowers` 插件（Claude Code 官方插件）。安装方法：
```
/plugin marketplace add anthropics/claude-plugins-official
/plugin install superpowers@anthropics/claude-plugins-official
```
如果未安装，工作流会提示跳过或安装。

## 许可证

MIT License
